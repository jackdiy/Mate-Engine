# Androidç§»æ¤æŠ€æœ¯æŠ¥å‘Š

## æ¦‚è¿°

æœ¬æŠ¥å‘Šè¯¦ç»†è¯´æ˜å¦‚ä½•å°†Mate Engine Webé¡¹ç›®ç§»æ¤åˆ°Androidå¹³å°ï¼ˆåŒ…æ‹¬ARMè®¾å¤‡ï¼‰ï¼Œæä¾›å®Œæ•´çš„æŠ€æœ¯æ–¹æ¡ˆå’Œå®æ–½è·¯å¾„ã€‚

---

## ğŸ“± ç§»æ¤æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆä¸€ï¼šWebViewæ–¹å¼ï¼ˆæ¨èç”¨äºå¿«é€ŸåŸå‹ï¼‰

**ä¼˜ç‚¹ï¼š**
- âœ… å¼€å‘é€Ÿåº¦å¿«ï¼Œä»£ç å¤ç”¨ç‡é«˜ï¼ˆ95%+ï¼‰
- âœ… ç»´æŠ¤æˆæœ¬ä½ï¼Œä¸€å¥—ä»£ç å¤šå¹³å°
- âœ… æ›´æ–°æ–¹ä¾¿ï¼Œæ— éœ€é‡æ–°æ‰“åŒ…

**ç¼ºç‚¹ï¼š**
- âš ï¸ æ€§èƒ½ç•¥ä½äºåŸç”Ÿæ–¹æ¡ˆ
- âš ï¸ WebGLåœ¨éƒ¨åˆ†è€æ—§è®¾å¤‡ä¸Šå¯èƒ½ä¸æµç•…
- âš ï¸ éœ€è¦ç½‘ç»œè®¿é—®ï¼ˆæˆ–æ‰“åŒ…èµ„æºï¼‰

**æŠ€æœ¯æ ˆï¼š**
- Android WebView
- Three.js + VRMï¼ˆå½“å‰WebæŠ€æœ¯æ ˆï¼‰
- Cordova/Capacitorï¼ˆå¯é€‰ï¼‰

### æ–¹æ¡ˆäºŒï¼šUnity + Androidï¼ˆæ¨èç”¨äºæœ€ä½³æ€§èƒ½ï¼‰

**ä¼˜ç‚¹ï¼š**
- âœ… æ€§èƒ½æœ€ä¼˜ï¼ŒåŸç”Ÿ3Dæ¸²æŸ“
- âœ… å®Œæ•´åŠŸèƒ½æ”¯æŒï¼ˆVRMã€åŠ¨ç”»ã€ç‰©ç†ç­‰ï¼‰
- âœ… å¯ä»¥ç›´æ¥ä½¿ç”¨ç°æœ‰Unityé¡¹ç›®ä»£ç 
- âœ… AR/VRæ”¯æŒæ›´å¥½

**ç¼ºç‚¹ï¼š**
- âš ï¸ å¼€å‘æ—¶é—´é•¿
- âš ï¸ APKä½“ç§¯å¤§ï¼ˆ100MB+ï¼‰
- âš ï¸ éœ€è¦Unityä¸“ä¸šçŸ¥è¯†

**æŠ€æœ¯æ ˆï¼š**
- Unity 2022.3 LTS +
- UniVRMæ’ä»¶
- Android NDK

### æ–¹æ¡ˆä¸‰ï¼šReact Native + Three.js

**ä¼˜ç‚¹ï¼š**
- âœ… æ€§èƒ½è¾ƒå¥½
- âœ… å¯ä½¿ç”¨ç°æœ‰Webä»£ç 
- âœ… è·¨å¹³å°ï¼ˆiOS + Androidï¼‰

**ç¼ºç‚¹ï¼š**
- âš ï¸ é…ç½®å¤æ‚
- âš ï¸ è°ƒè¯•å›°éš¾
- âš ï¸ ç¤¾åŒºç”Ÿæ€ç›¸å¯¹å°ä¼—

---

## ğŸ¯ æ¨èæ–¹æ¡ˆè¯¦è§£

æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œæˆ‘ä»¬æä¾›ä¸¤ä¸ªä¸»è¦æ¨èæ–¹æ¡ˆï¼š

---

## æ–¹æ¡ˆAï¼šWebViewæ··åˆåº”ç”¨ï¼ˆå¿«é€Ÿéƒ¨ç½²ï¼‰

### æŠ€æœ¯æ¶æ„

```
Android App
â”œâ”€â”€ WebViewå®¹å™¨
â”‚   â”œâ”€â”€ HTML/CSS/JSï¼ˆWebç‰ˆä»£ç ï¼‰
â”‚   â”œâ”€â”€ Three.jså¼•æ“
â”‚   â””â”€â”€ VRMåŠ è½½å™¨
â”œâ”€â”€ Native Bridge
â”‚   â”œâ”€â”€ æ–‡ä»¶è®¿é—®
â”‚   â”œâ”€â”€ ä¼ æ„Ÿå™¨æ•°æ®
â”‚   â””â”€â”€ æ€§èƒ½ä¼˜åŒ–
â””â”€â”€ èµ„æºç®¡ç†
    â”œâ”€â”€ VRMæ¨¡å‹æ‰“åŒ…
    â””â”€â”€ åŠ¨ç”»æ–‡ä»¶
```

### å®æ–½æ­¥éª¤

#### 1. åˆ›å»ºAndroidé¡¹ç›®

```bash
# ä½¿ç”¨Android Studioåˆ›å»ºæ–°é¡¹ç›®
# é€‰æ‹© Empty Activity
# æœ€ä½SDKï¼šAPI 24 (Android 7.0)
# ç›®æ ‡SDKï¼šAPI 34 (Android 14)
```

#### 2. æ·»åŠ WebViewé…ç½®

**MainActivity.java**
```java
package com.mateengine.app;

import android.os.Bundle;
import android.webkit.WebView;
import android.webkit.WebSettings;
import android.webkit.WebViewClient;
import android.webkit.WebChromeClient;
import androidx.appcompat.app.AppCompatActivity;

public class MainActivity extends AppCompatActivity {
    private WebView webView;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        
        webView = findViewById(R.id.webview);
        setupWebView();
        
        // åŠ è½½Webåº”ç”¨
        webView.loadUrl("file:///android_asset/index.html");
    }
    
    private void setupWebView() {
        WebSettings settings = webView.getSettings();
        
        // å¯ç”¨JavaScript
        settings.setJavaScriptEnabled(true);
        
        // å¯ç”¨DOMå­˜å‚¨
        settings.setDomStorageEnabled(true);
        
        // å¯ç”¨æ•°æ®åº“
        settings.setDatabaseEnabled(true);
        
        // å¯ç”¨WebGL
        settings.setJavaScriptCanOpenWindowsAutomatically(true);
        settings.setAllowFileAccess(true);
        settings.setAllowContentAccess(true);
        
        // è®¾ç½®WebGLæ”¯æŒ
        settings.setMediaPlaybackRequiresUserGesture(false);
        
        // ç¡¬ä»¶åŠ é€Ÿ
        webView.setLayerType(View.LAYER_TYPE_HARDWARE, null);
        
        // è®¾ç½®WebViewClient
        webView.setWebViewClient(new WebViewClient() {
            @Override
            public boolean shouldOverrideUrlLoading(WebView view, String url) {
                view.loadUrl(url);
                return true;
            }
        });
        
        // è®¾ç½®WebChromeClientï¼ˆç”¨äºæ–‡ä»¶é€‰æ‹©ç­‰ï¼‰
        webView.setWebChromeClient(new WebChromeClient());
    }
    
    @Override
    public void onBackPressed() {
        if (webView.canGoBack()) {
            webView.goBack();
        } else {
            super.onBackPressed();
        }
    }
}
```

**activity_main.xml**
```xml
<?xml version="1.0" encoding="utf-8"?>
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent">
    
    <WebView
        android:id="@+id/webview"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />
</FrameLayout>
```

#### 3. æ‰“åŒ…Webèµ„æº

å°†ä»¥ä¸‹æ–‡ä»¶å¤åˆ¶åˆ° `app/src/main/assets/` ç›®å½•ï¼š
- index.html
- styles.css
- app.js
- Assets/ï¼ˆVRMæ¨¡å‹æ–‡ä»¶ï¼‰

#### 4. AndroidManifest.xmlé…ç½®

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    
    <!-- æƒé™ -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
    
    <!-- OpenGL ES 3.0 -->
    <uses-feature android:glEsVersion="0x00030000" android:required="true" />
    
    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:usesCleartextTraffic="true"
        android:hardwareAccelerated="true"
        android:theme="@style/Theme.MateEngine">
        
        <activity
            android:name=".MainActivity"
            android:configChanges="orientation|screenSize"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>
</manifest>
```

#### 5. ä¼˜åŒ–æ€§èƒ½

**åœ¨app.jsä¸­æ·»åŠ Androidä¼˜åŒ–ï¼š**

```javascript
// æ£€æµ‹Androidç¯å¢ƒ
const isAndroid = /Android/i.test(navigator.userAgent);

if (isAndroid) {
    // é™ä½æ¸²æŸ“åˆ†è¾¨ç‡
    state.renderer.setPixelRatio(1);
    
    // é™ä½é˜´å½±è´´å›¾åˆ†è¾¨ç‡
    directionalLight.shadow.mapSize.width = 1024;
    directionalLight.shadow.mapSize.height = 1024;
    
    // å¯ç”¨æ€§èƒ½æ¨¡å¼
    state.renderer.powerPreference = 'high-performance';
}
```

---

## æ–¹æ¡ˆBï¼šUnity + Androidï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰

### æŠ€æœ¯æ¶æ„

```
Unityé¡¹ç›®
â”œâ”€â”€ VRMå¯¼å…¥ï¼ˆUniVRMï¼‰
â”œâ”€â”€ åŠ¨ç”»ç³»ç»Ÿ
â”œâ”€â”€ éŸ³é¢‘ç³»ç»Ÿ
â”œâ”€â”€ UIç³»ç»Ÿï¼ˆuGUIï¼‰
â””â”€â”€ Androidæ„å»º
    â”œâ”€â”€ IL2CPPåç«¯
    â”œâ”€â”€ ARM64æ¶æ„
    â””â”€â”€ èµ„æºå‹ç¼©
```

### å®æ–½æ­¥éª¤

#### 1. Unityé¡¹ç›®é…ç½®

**å·²æœ‰é¡¹ç›®ï¼š** 
- å½“å‰ä»“åº“å·²ç»æ˜¯Unityé¡¹ç›®
- ä½¿ç”¨Unity 6000.2.6f2
- å·²é›†æˆVRMæ”¯æŒ

**æ„å»ºé…ç½®ï¼š**

```csharp
// åœ¨Unity Editorä¸­
// File -> Build Settings
// Platform: Android
// Architecture: ARM64
// Compression Method: LZ4
// Scripting Backend: IL2CPP
```

#### 2. ä¼˜åŒ–Androidæ„å»º

**PlayerSettingsé…ç½®ï¼š**

```csharp
// C# è„šæœ¬ç¤ºä¾‹
#if UNITY_EDITOR
using UnityEditor;

public class AndroidBuildSettings
{
    [MenuItem("Build/Configure Android")]
    static void ConfigureAndroid()
    {
        PlayerSettings.Android.minSdkVersion = AndroidSdkVersions.AndroidApiLevel24;
        PlayerSettings.Android.targetSdkVersion = AndroidSdkVersions.AndroidApiLevel34;
        
        // å›¾å½¢API
        PlayerSettings.SetGraphicsAPIs(BuildTarget.Android, new[] {
            GraphicsDeviceType.Vulkan,
            GraphicsDeviceType.OpenGLES3
        });
        
        // IL2CPP
        PlayerSettings.SetScriptingBackend(BuildTargetGroup.Android, ScriptingImplementation.IL2CPP);
        
        // ARM64
        PlayerSettings.Android.targetArchitectures = AndroidArchitecture.ARM64;
        
        // å‹ç¼©
        EditorUserBuildSettings.androidBuildSystem = AndroidBuildSystem.Gradle;
        
        Debug.Log("Androidé…ç½®å®Œæˆ");
    }
}
#endif
```

#### 3. VRMæ¨¡å‹ä¼˜åŒ–

**é’ˆå¯¹ç§»åŠ¨è®¾å¤‡çš„ä¼˜åŒ–ï¼š**

```csharp
// VRMOptimizer.cs
using UnityEngine;
using VRM;

public class VRMOptimizer : MonoBehaviour
{
    void OptimizeVRMForMobile(GameObject vrmRoot)
    {
        // é™ä½çº¹ç†åˆ†è¾¨ç‡
        Renderer[] renderers = vrmRoot.GetComponentsInChildren<Renderer>();
        foreach (var renderer in renderers)
        {
            foreach (var material in renderer.materials)
            {
                if (material.mainTexture != null)
                {
                    Texture2D tex = material.mainTexture as Texture2D;
                    if (tex != null && tex.width > 1024)
                    {
                        // ä½¿ç”¨å‹ç¼©æ ¼å¼
                        TextureImporter importer = AssetImporter.GetAtPath(
                            AssetDatabase.GetAssetPath(tex)) as TextureImporter;
                        if (importer != null)
                        {
                            importer.textureCompression = TextureImporterCompression.Compressed;
                            importer.maxTextureSize = 1024;
                            importer.SaveAndReimport();
                        }
                    }
                }
            }
        }
        
        // ä¼˜åŒ–éª¨éª¼æ•°é‡
        SkinnedMeshRenderer[] smrs = vrmRoot.GetComponentsInChildren<SkinnedMeshRenderer>();
        foreach (var smr in smrs)
        {
            smr.quality = SkinQuality.Bone2; // é™åˆ¶éª¨éª¼å½±å“æ•°
        }
        
        Debug.Log("VRMç§»åŠ¨ç«¯ä¼˜åŒ–å®Œæˆ");
    }
}
```

#### 4. æ„å»ºAPK

**Gradleé…ç½®ï¼ˆbuild.gradleï¼‰ï¼š**

```gradle
android {
    compileSdkVersion 34
    
    defaultConfig {
        minSdkVersion 24
        targetSdkVersion 34
        versionCode 1
        versionName "1.0"
        
        ndk {
            abiFilters 'arm64-v8a'
        }
    }
    
    buildTypes {
        release {
            minifyEnabled true
            shrinkResources true
            proguardFiles getDefaultProguardFile('proguard-android.txt')
        }
    }
    
    // å¯ç”¨èµ„æºå‹ç¼©
    aaptOptions {
        cruncherEnabled = true
    }
}
```

#### 5. æ€§èƒ½ä¼˜åŒ–

**é’ˆå¯¹ARMè®¾å¤‡çš„ä¼˜åŒ–ï¼š**

```csharp
// PerformanceManager.cs
using UnityEngine;

public class PerformanceManager : MonoBehaviour
{
    void Start()
    {
        // è®¾ç½®ç›®æ ‡å¸§ç‡
        Application.targetFrameRate = 60;
        
        // å…³é—­vsyncï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰
        QualitySettings.vSyncCount = 0;
        
        // åŠ¨æ€è°ƒæ•´è´¨é‡
        if (SystemInfo.systemMemorySize < 4096) // å°äº4GBå†…å­˜
        {
            QualitySettings.SetQualityLevel(1); // ä½è´¨é‡
            QualitySettings.shadowDistance = 20f;
            QualitySettings.shadows = ShadowQuality.HardOnly;
        }
        
        // å¤šçº¿ç¨‹æ¸²æŸ“
        PlayerSettings.MTRendering = true;
    }
}
```

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“

| ç‰¹æ€§ | WebViewæ–¹æ¡ˆ | Unityæ–¹æ¡ˆ |
|------|------------|-----------|
| **å¼€å‘æ—¶é—´** | 1-2å‘¨ | 4-6å‘¨ |
| **æ€§èƒ½** | ä¸­ç­‰ï¼ˆ60fps @ æ——èˆ°æœºï¼‰ | ä¼˜ç§€ï¼ˆ60fps @ ä¸­ç«¯æœºï¼‰ |
| **APKå¤§å°** | 20-50MB | 100-200MB |
| **ç»´æŠ¤æˆæœ¬** | ä½ | ä¸­ |
| **åŠŸèƒ½å®Œæ•´åº¦** | 85% | 100% |
| **ç¡¬ä»¶è¦æ±‚** | Android 7.0+ | Android 7.0+ |
| **WebGLæ”¯æŒ** | éœ€è¦ | ä¸éœ€è¦ |
| **ç¦»çº¿ä½¿ç”¨** | æ”¯æŒï¼ˆæ‰“åŒ…èµ„æºï¼‰ | å®Œå…¨æ”¯æŒ |
| **AR/VR** | å›°éš¾ | ç®€å• |

---

## ğŸ”§ å…·ä½“å®æ–½å»ºè®®

### é˜¶æ®µä¸€ï¼šå¿«é€ŸåŸå‹ï¼ˆæ¨èWebViewï¼‰

1. **ç¬¬ä¸€å‘¨ï¼š** WebViewåŸºç¡€æ­å»º
   - åˆ›å»ºAndroidé¡¹ç›®
   - é›†æˆWebView
   - æ‰“åŒ…Webèµ„æº
   
2. **ç¬¬äºŒå‘¨ï¼š** åŠŸèƒ½æµ‹è¯•ä¸ä¼˜åŒ–
   - æ€§èƒ½è°ƒä¼˜
   - UIé€‚é…
   - å®é™…è®¾å¤‡æµ‹è¯•

### é˜¶æ®µäºŒï¼šå®Œæ•´ç‰ˆæœ¬ï¼ˆUnityï¼‰

1. **ç¬¬1-2å‘¨ï¼š** Unityé¡¹ç›®é…ç½®
   - å¯¼å…¥ç°æœ‰é¡¹ç›®
   - é…ç½®Androidæ„å»º
   - ä¼˜åŒ–èµ„æº

2. **ç¬¬3-4å‘¨ï¼š** Androidé€‚é…
   - è§¦æ‘¸è¾“å…¥é€‚é…
   - UIé‡æ–°è®¾è®¡ï¼ˆç§»åŠ¨ç«¯ï¼‰
   - æ€§èƒ½ä¼˜åŒ–

3. **ç¬¬5-6å‘¨ï¼š** æµ‹è¯•ä¸å‘å¸ƒ
   - å¤šè®¾å¤‡æµ‹è¯•
   - Bugä¿®å¤
   - æ‰“åŒ…å‘å¸ƒ

---

## ğŸ“± ARMè®¾å¤‡ç‰¹æ®Šè€ƒè™‘

### CPUæ¶æ„

```java
// æ£€æµ‹CPUæ¶æ„
String[] abis = Build.SUPPORTED_ABIS;
// ä¼˜å…ˆæ”¯æŒï¼šarm64-v8a
// å‘åå…¼å®¹ï¼šarmeabi-v7a
```

### æ€§èƒ½ä¼˜åŒ–

1. **é™ä½å¤šè¾¹å½¢æ•°**
   - VRMæ¨¡å‹ï¼š< 50Kä¸‰è§’å½¢
   - åœºæ™¯ç‰©ä½“ï¼šæœ€å°åŒ–

2. **çº¹ç†å‹ç¼©**
   - ä½¿ç”¨ASTCæ ¼å¼
   - æœ€å¤§2Kåˆ†è¾¨ç‡

3. **åŠ¨ç”»ä¼˜åŒ–**
   - éª¨éª¼æ•°é‡ < 100
   - å…³é”®å¸§å‹ç¼©

### çƒ­ç‚¹è®¾å¤‡æµ‹è¯•

- âœ… å°ç±³/çº¢ç±³ï¼ˆä¸»æµï¼‰
- âœ… OPPO/vivo
- âœ… ä¸‰æ˜ŸGalaxyç³»åˆ—
- âœ… åä¸º/è£è€€

---

## ğŸ¯ æœ€ç»ˆæ¨è

**å¯¹äºå½“å‰é¡¹ç›®ï¼š**

1. **çŸ­æœŸï¼ˆ1-2ä¸ªæœˆï¼‰ï¼š** ä½¿ç”¨WebViewæ–¹æ¡ˆ
   - å¿«é€Ÿä¸Šçº¿
   - éªŒè¯å¸‚åœºéœ€æ±‚
   - ä½æˆæœ¬è¯•é”™

2. **é•¿æœŸï¼ˆ3-6ä¸ªæœˆï¼‰ï¼š** è¿ç§»åˆ°Unity
   - åŸºäºç°æœ‰Unityä»£ç 
   - å®Œæ•´åŠŸèƒ½æ”¯æŒ
   - æ›´å¥½çš„æ€§èƒ½

3. **æ··åˆæ–¹æ¡ˆï¼š** ä¸¤è€…å¹¶è¡Œ
   - WebViewç‰ˆæœ¬ç”¨äºå¿«é€Ÿè¿­ä»£
   - Unityç‰ˆæœ¬ç”¨äºæ——èˆ°ä½“éªŒ
   - æ ¹æ®ç”¨æˆ·è®¾å¤‡è‡ªåŠ¨é€‰æ‹©

---

## ğŸ“š å‚è€ƒèµ„æº

### WebViewæ–¹æ¡ˆ
- Android WebViewå®˜æ–¹æ–‡æ¡£
- Capacitoræ¡†æ¶
- Cordovaæ’ä»¶

### Unityæ–¹æ¡ˆ
- Unity Androidå¼€å‘æŒ‡å—
- UniVRMæ’ä»¶æ–‡æ¡£
- IL2CPPä¼˜åŒ–æŒ‡å—

### æµ‹è¯•å·¥å…·
- Android Studio Profiler
- Unity Profiler
- Firebase Performance Monitoring

---

## âœ… ç»“è®º

**æ˜¯çš„ï¼Œæ‚¨éœ€è¦Unity + Androidçš„ä»£ç æ¥ç§»æ¤åˆ°ARMè®¾å¤‡ã€‚**

ä½†æˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªæ–¹æ¡ˆï¼š

1. **WebViewæ–¹æ¡ˆï¼ˆå¿«é€Ÿï¼‰ï¼š** 
   - ä½¿ç”¨å½“å‰Webä»£ç 
   - å°‘é‡Java/Kotlinä»£ç 
   - 1-2å‘¨å®Œæˆ

2. **Unityæ–¹æ¡ˆï¼ˆå®Œæ•´ï¼‰ï¼š**
   - ä½¿ç”¨ç°æœ‰Unityé¡¹ç›®
   - C#ä»£ç ä¸ºä¸»
   - 4-6å‘¨å®Œæˆ

**æ¨èè·¯å¾„ï¼š** å…ˆWebViewéªŒè¯ï¼ŒåUnityä¼˜åŒ–ã€‚

---

**æŠ¥å‘Šæ—¥æœŸï¼š** 2025-12-07  
**æŠ€æœ¯æ ˆç‰ˆæœ¬ï¼š** Unity 6000.2.6f2 / Android API 34 / Three.js 0.169.0
